<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Validator Test</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            padding: 40px;
            background-color: #f8f9fa;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .url-input {
            border-width: 2px !important;
        }
        .validation-message {
            margin-top: 8px;
            font-size: 0.875rem;
        }
        .test-urls {
            margin-top: 30px;
        }
        .test-url-btn {
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="mb-4">URL Validator Test</h1>

        <form id="test-form">
            <div class="mb-3">
                <label for="url-input" class="form-label">Enter URL to validate:</label>
                <input
                    type="text"
                    class="form-control url-input"
                    id="url-input"
                    placeholder="https://example.com"
                    autocomplete="off"
                >
                <div id="validation-message" class="validation-message"></div>
            </div>

            <button type="submit" class="btn btn-primary" id="submit-btn">
                <i class="fas fa-check me-2"></i>Submit
            </button>
        </form>

        <div class="test-urls">
            <h5>Test URLs:</h5>
            <div class="d-flex flex-wrap">
                <button class="btn btn-sm btn-outline-secondary test-url-btn" data-url="https://google.com">
                    ‚úÖ Valid (google.com)
                </button>
                <button class="btn btn-sm btn-outline-secondary test-url-btn" data-url="https://httpbin.org/status/404">
                    ‚ùå 404 Error (httpbin)
                </button>
                <button class="btn btn-sm btn-outline-secondary test-url-btn" data-url="https://httpbin.org/status/200">
                    ‚úÖ 200 Success (httpbin)
                </button>
                <button class="btn btn-sm btn-outline-secondary test-url-btn" data-url="https://httpstat.us/301">
                    ‚ö†Ô∏è 301 Redirect
                </button>
                <button class="btn btn-sm btn-outline-secondary test-url-btn" data-url="https://httpstat.us/302">
                    ‚ö†Ô∏è 302 Redirect
                </button>
                <button class="btn btn-sm btn-outline-secondary test-url-btn" data-url="https://httpstat.us/401">
                    üîí 401 Unauthorized
                </button>
                <button class="btn btn-sm btn-outline-secondary test-url-btn" data-url="https://httpstat.us/500">
                    ‚ùå 500 Server Error
                </button>
                <button class="btn btn-sm btn-outline-secondary test-url-btn" data-url="not-a-url">
                    ‚ùå Invalid Format
                </button>
            </div>
        </div>

        <div class="mt-4">
            <h5>Validation Status:</h5>
            <div id="status-output" class="alert alert-info">
                Waiting for validation...
            </div>
        </div>
    </div>

    <!-- URL Validator Library -->
    <script src="assets/js/url-validator.js"></script>

    <script>
        // Initialize
        const urlInput = document.getElementById('url-input');
        const validationMessage = document.getElementById('validation-message');
        const statusOutput = document.getElementById('status-output');
        const submitBtn = document.getElementById('submit-btn');
        const testForm = document.getElementById('test-form');

        let isValid = false;

        // Create validator instance (no proxy for this test, direct requests)
        const validator = new URLValidator({
            isUserRegistered: false,  // Test as guest user
            proxyUrl: null,  // Direct requests (will have CORS issues on some URLs)
            timeout: 10000
        });

        // Handle validation result
        function handleValidationResult(result, url) {
            console.log('Validation result:', result);

            // Update status output
            statusOutput.className = 'alert';
            if (result.isError) {
                statusOutput.classList.add('alert-danger');
                statusOutput.innerHTML = '<i class="fas fa-times-circle me-2"></i><strong>Error:</strong> ' + result.message;
                isValid = false;
                // Disable submit button
                submitBtn.disabled = true;
            } else if (result.isWarning) {
                statusOutput.classList.add('alert-warning');
                statusOutput.innerHTML = '<i class="fas fa-exclamation-triangle me-2"></i><strong>Warning:</strong> ' + result.message;
                isValid = true;  // Warnings allow submission
                // Enable submit button
                submitBtn.disabled = false;
            } else {
                statusOutput.classList.add('alert-success');
                statusOutput.innerHTML = '<i class="fas fa-check-circle me-2"></i><strong>Success:</strong> ' + result.message;
                isValid = true;
                // Enable submit button
                submitBtn.disabled = false;
            }

            // Show validation details
            if (result.errorType) {
                statusOutput.innerHTML += '<br><small>Error Type: ' + result.errorType + '</small>';
            }
            if (result.redirectLocation) {
                statusOutput.innerHTML += '<br><small>Redirect to: ' + result.redirectLocation + '</small>';
            }

            // Update visual feedback
            if (result.isError) {
                urlInput.classList.remove('is-valid');
                urlInput.classList.add('is-invalid');
                validationMessage.className = 'validation-message text-danger';
                validationMessage.innerHTML = '<i class="fas fa-times-circle me-2"></i>' + result.message;
            } else if (result.isWarning) {
                urlInput.classList.remove('is-invalid');
                urlInput.classList.add('is-valid');
                validationMessage.className = 'validation-message text-warning';
                validationMessage.innerHTML = '<i class="fas fa-exclamation-triangle me-2"></i>' + result.message;
            } else {
                urlInput.classList.remove('is-invalid');
                urlInput.classList.add('is-valid');
                validationMessage.className = 'validation-message text-success';
                validationMessage.innerHTML = '<i class="fas fa-check-circle me-2"></i>' + result.message;
            }
        }

        // Create debounced validator
        const debouncedValidate = validator.createDebouncedValidator(handleValidationResult, 800);

        // Input event
        urlInput.addEventListener('input', (e) => {
            const value = e.target.value.trim();

            // Reset
            urlInput.classList.remove('is-valid', 'is-invalid');
            validationMessage.textContent = '';

            if (value.length > 0) {
                // Show validating message
                validationMessage.className = 'validation-message text-muted';
                validationMessage.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Validating...';

                // Disable submit button while validating
                submitBtn.disabled = true;

                // Trigger validation
                debouncedValidate(value, null, null);
            } else {
                statusOutput.className = 'alert alert-info';
                statusOutput.textContent = 'Waiting for validation...';
                // Disable submit button when empty
                submitBtn.disabled = true;
            }
        });

        // Form submit
        testForm.addEventListener('submit', (e) => {
            e.preventDefault();

            if (!isValid) {
                alert('URL validation failed! Please fix the errors.');
                return;
            }

            alert('Form submitted successfully! URL is valid.');
        });

        // Test URL buttons
        document.querySelectorAll('.test-url-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const url = btn.getAttribute('data-url');
                urlInput.value = url;
                urlInput.dispatchEvent(new Event('input'));
            });
        });
    </script>
</body>
</html>
